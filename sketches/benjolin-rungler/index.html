<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benjolin Rungler - ASCII Art</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --panel-bg: #12121a;
            --text: #e0e0e0;
            --text-dim: #606070;
            --accent: #00ff88;
            --accent-dim: #00aa55;
            --border: #252535;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 12px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 18px;
            font-weight: 500;
            color: var(--accent);
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 11px;
            margin-left: 10px;
        }

        .version {
            color: var(--text-dim);
            font-size: 11px;
        }

        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        .canvas-container {
            position: relative;
            flex-shrink: 0;
        }

        #defaultCanvas0, canvas {
            display: block;
            border: 1px solid var(--border);
        }

        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 700px;
            overflow-y: auto;
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
        }

        .panel h2 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hash-display {
            font-size: 10px;
            color: var(--text-dim);
            word-break: break-all;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            margin-bottom: 10px;
        }

        .features-table {
            width: 100%;
            border-collapse: collapse;
        }

        .features-table td {
            padding: 6px 4px;
            border-bottom: 1px solid var(--border);
        }

        .features-table tr:last-child td {
            border-bottom: none;
        }

        .features-table td:first-child {
            color: var(--text-dim);
        }

        .features-table td:nth-child(2) {
            text-align: right;
            font-weight: 500;
        }

        .color-swatch {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 6px;
            vertical-align: middle;
        }

        .button-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        button {
            background: var(--border);
            border: none;
            color: var(--text);
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            transition: background 0.2s;
        }

        button:hover {
            background: #3a3a4a;
        }

        button.primary {
            background: var(--accent-dim);
            color: var(--bg);
        }

        button.primary:hover {
            background: var(--accent);
        }

        .hints {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .hint {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        kbd {
            background: var(--border);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            min-width: 20px;
            text-align: center;
        }

        .hint-text {
            color: var(--text-dim);
            font-size: 10px;
        }

        .color-schemes {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .scheme-btn {
            padding: 6px 10px;
            font-size: 10px;
        }

        .scheme-btn.active {
            background: var(--accent-dim);
            color: var(--bg);
        }

        .layer-toggles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 11px;
            color: var(--text-dim);
        }

        .toggle-label:hover {
            color: var(--text);
        }

        .toggle-label input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .toggle-label input[type="checkbox"]:checked + span {
            color: var(--accent);
        }

        .param-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 12px;
        }

        .param-row:last-child {
            margin-bottom: 0;
        }

        .param-row label {
            font-size: 11px;
            color: var(--text-dim);
            display: flex;
            justify-content: space-between;
        }

        .param-row label span {
            color: var(--accent);
            font-weight: 500;
        }

        .param-row input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--border);
            border-radius: 2px;
            outline: none;
        }

        .param-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        .param-row input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .param-row select {
            width: 100%;
            padding: 6px 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 3px;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
        }

        .param-row select:focus {
            outline: none;
            border-color: var(--accent-dim);
        }

        .ascii-preview {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px;
            border-radius: 3px;
            color: var(--accent);
            line-height: 1.2;
            white-space: pre;
        }

        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }

            .sidebar {
                width: 100%;
                max-width: 700px;
                max-height: none;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>
<body>
    <header>
        <div>
            <h1>Benjolin Rungler<span class="subtitle">ASCII Art Mode</span></h1>
        </div>
        <span class="version">v4.0.1</span>
    </header>

    <div class="main-container">
        <div class="canvas-container" id="canvas-container">
            <!-- p5.js canvas will be inserted here -->
        </div>

        <div class="sidebar">
            <!-- Overview -->
            <div class="panel">
                <h2>About</h2>
                <p style="color: var(--text-dim); line-height: 1.5; margin-bottom: 10px;">
                    Unified chaos field visualization - all Benjolin signals intersect
                    and modulate each other across the entire canvas. No panels, pure
                    visual interplay of oscillators, runglers, resonator, and clock.
                </p>
                <div class="ascii-preview">  ∿∿∿ OSC A ∿∿∿   ║║║ OSC B ║║║
    ╲╲ RUNGLER A    ╱╱ RUNGLER B
       ◎ RESONATOR SPIRAL ◎
    ┼┼ COMPARATOR ┼┼  · S&H ·</div>
            </div>

            <!-- Features -->
            <div class="panel">
                <h2>Features</h2>
                <div class="hash-display" id="hash-display">Loading...</div>
                <table class="features-table">
                    <tbody id="features-body">
                        <tr><td>Loading...</td><td></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Layer Toggles -->
            <div class="panel">
                <h2>Layers</h2>
                <div class="layer-toggles">
                    <label class="toggle-label"><input type="checkbox" id="layer-oscA" checked><span>OSC A (Horizontal)</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-oscB" checked><span>OSC B (Vertical)</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-runglerA" checked><span>Rungler A</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-runglerB" checked><span>Rungler B</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-resonator" checked><span>Resonator</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-comparator" checked><span>Comparator</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-sh" checked><span>S&H Particles</span></label>
                    <label class="toggle-label"><input type="checkbox" id="layer-clock" checked><span>Clock Pulses</span></label>
                </div>
            </div>

            <!-- Parameters -->
            <div class="panel">
                <h2>Parameters</h2>
                <div class="param-row">
                    <label>Intersection</label>
                    <select id="param-intersection">
                        <option value="additive">Additive</option>
                        <option value="xor">XOR</option>
                        <option value="multiply">Multiply</option>
                        <option value="interference">Interference</option>
                    </select>
                </div>
                <div class="param-row">
                    <label>Wave Count <span id="waveCount-val">5</span></label>
                    <input type="range" id="param-waveCount" min="1" max="12" value="5">
                </div>
                <div class="param-row">
                    <label>Speed <span id="speed-val">1.0</span></label>
                    <input type="range" id="param-speed" min="0.1" max="3" step="0.1" value="1">
                </div>
                <div class="param-row">
                    <label>Density <span id="density-val">0.7</span></label>
                    <input type="range" id="param-density" min="0.1" max="1.5" step="0.1" value="0.7">
                </div>
                <div class="param-row">
                    <label>Spiral <span id="spiral-val">1.0</span></label>
                    <input type="range" id="param-spiral" min="0.1" max="4" step="0.1" value="1">
                </div>
                <div class="param-row">
                    <label>Chaos <span id="chaos-val">0.7</span></label>
                    <input type="range" id="param-chaos" min="0" max="1" step="0.05" value="0.7">
                </div>
            </div>

            <!-- Color Schemes -->
            <div class="panel">
                <h2>Color Scheme</h2>
                <div class="color-schemes">
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(0)">Phosphor</button>
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(1)">Amber</button>
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(2)">Blue</button>
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(3)">Matrix</button>
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(4)">Thermal</button>
                    <button class="scheme-btn" onclick="benjolin.setColorScheme(5)">Cyan</button>
                </div>
            </div>

            <!-- Controls -->
            <div class="panel">
                <h2>Controls</h2>
                <div class="button-row">
                    <button class="primary" onclick="benjolin.regenerate()">Regenerate (R)</button>
                    <button onclick="saveCanvas('benjolin-ascii', 'png')">Save PNG (S)</button>
                </div>
            </div>

            <!-- Keyboard Hints -->
            <div class="panel">
                <h2>Keyboard</h2>
                <div class="hints">
                    <div class="hint"><kbd>R</kbd><span class="hint-text">Regenerate</span></div>
                    <div class="hint"><kbd>S</kbd><span class="hint-text">Save PNG</span></div>
                </div>
            </div>

            <!-- Version History -->
            <div class="panel">
                <h2>Version</h2>
                <select id="version-select" style="width: 100%; padding: 8px; background: var(--bg); border: 1px solid var(--border); color: var(--text); border-radius: 3px;">
                    <option value="sketch.js">v4.0.1 - Unified Chaos + UI (current)</option>
                    <option value="versions/v3.3.0-full-architecture.js">v3.3.0 - Full Benjolin Panels</option>
                    <option value="versions/v2.0.0-webgl.js">v2.0.0 - WebGL Shader</option>
                    <option value="versions/v1.0.0-sketch.js">v1.0.0 - Initial GLSL</option>
                </select>
            </div>
        </div>
    </div>

    <script src="sketch.js"></script>
    <script>
        // Wait for sketch.js to initialize
        function initUI() {
            if (typeof window.features === 'undefined' || typeof window.layers === 'undefined') {
                setTimeout(initUI, 50);
                return;
            }

            console.log('Initializing UI controls...');

            // Move canvas into container
            const container = document.getElementById('canvas-container');
            const canvas = document.querySelector('canvas');
            if (canvas && canvas.parentElement !== container) {
                container.appendChild(canvas);
            }

            // Setup layer toggle listeners
            const layerNames = ['oscA', 'oscB', 'runglerA', 'runglerB', 'resonator', 'comparator', 'sh', 'clock'];
            layerNames.forEach(name => {
                const el = document.getElementById('layer-' + name);
                if (el) {
                    el.addEventListener('change', function() {
                        window.layers[name] = this.checked;
                        console.log('Layer', name, '=', this.checked);
                    });
                }
            });

            // Intersection style
            document.getElementById('param-intersection').addEventListener('change', function() {
                window.features.intersectionStyle = this.value;
                console.log('Intersection =', this.value);
            });

            // Wave count
            document.getElementById('param-waveCount').addEventListener('input', function() {
                window.features.waveCount = parseInt(this.value);
                document.getElementById('waveCount-val').textContent = this.value;
            });

            // Speed
            document.getElementById('param-speed').addEventListener('input', function() {
                window.features.speed = parseFloat(this.value);
                document.getElementById('speed-val').textContent = parseFloat(this.value).toFixed(1);
            });

            // Density
            document.getElementById('param-density').addEventListener('input', function() {
                window.features.density = parseFloat(this.value);
                document.getElementById('density-val').textContent = parseFloat(this.value).toFixed(1);
            });

            // Spiral
            document.getElementById('param-spiral').addEventListener('input', function() {
                window.features.spiralTightness = parseFloat(this.value);
                document.getElementById('spiral-val').textContent = parseFloat(this.value).toFixed(1);
            });

            // Chaos
            document.getElementById('param-chaos').addEventListener('input', function() {
                window.features.chaos = parseFloat(this.value);
                document.getElementById('chaos-val').textContent = parseFloat(this.value).toFixed(2);
            });

            // Initial sync
            updateFeaturesDisplay();

            // Wrap regenerate to re-sync UI
            const origRegen = window.benjolin?.regenerate;
            if (origRegen) {
                window.benjolin.regenerate = function() {
                    origRegen();
                    setTimeout(updateFeaturesDisplay, 50);
                };
            }

            console.log('UI controls ready');
        }

        function updateFeaturesDisplay() {
            if (typeof window.features === 'undefined' || typeof hash === 'undefined') {
                return;
            }

            document.getElementById('hash-display').textContent = hash;

            const f = window.features;

            document.getElementById('features-body').innerHTML = `
                <tr><td>Color Scheme</td><td><span class="color-swatch" style="background: rgb(${f.colorScheme.fg.join(',')})"></span>${f.colorScheme.name}</td></tr>
                <tr><td>Intersection</td><td>${f.intersectionStyle}</td></tr>
                <tr><td>Wave Count</td><td>${f.waveCount}</td></tr>
                <tr><td>Rate A</td><td>${f.rateA.toFixed(2)}</td></tr>
                <tr><td>Rate B</td><td>${f.rateB.toFixed(2)}</td></tr>
                <tr><td>FM A→B</td><td>${(f.fmAtoB * 100).toFixed(0)}%</td></tr>
                <tr><td>FM B→A</td><td>${(f.fmBtoA * 100).toFixed(0)}%</td></tr>
                <tr><td>Rungler A Bits</td><td>${f.runglerABits}</td></tr>
                <tr><td>Rungler B Bits</td><td>${f.runglerBBits}</td></tr>
                <tr><td>Spiral</td><td>${f.spiralTightness.toFixed(2)}</td></tr>
                <tr><td>Density</td><td>${f.density.toFixed(2)}</td></tr>
                <tr><td>Chaos</td><td>${(f.chaos * 100).toFixed(0)}%</td></tr>
            `;

            // Sync controls to current values
            const l = window.layers;

            document.getElementById('layer-oscA').checked = l.oscA;
            document.getElementById('layer-oscB').checked = l.oscB;
            document.getElementById('layer-runglerA').checked = l.runglerA;
            document.getElementById('layer-runglerB').checked = l.runglerB;
            document.getElementById('layer-resonator').checked = l.resonator;
            document.getElementById('layer-comparator').checked = l.comparator;
            document.getElementById('layer-sh').checked = l.sh;
            document.getElementById('layer-clock').checked = l.clock;

            document.getElementById('param-intersection').value = f.intersectionStyle;
            document.getElementById('param-waveCount').value = f.waveCount;
            document.getElementById('waveCount-val').textContent = f.waveCount;
            document.getElementById('param-speed').value = f.speed;
            document.getElementById('speed-val').textContent = f.speed.toFixed(1);
            document.getElementById('param-density').value = f.density;
            document.getElementById('density-val').textContent = f.density.toFixed(1);
            document.getElementById('param-spiral').value = f.spiralTightness;
            document.getElementById('spiral-val').textContent = f.spiralTightness.toFixed(1);
            document.getElementById('param-chaos').value = f.chaos;
            document.getElementById('chaos-val').textContent = f.chaos.toFixed(2);
        }

        // Start initialization
        initUI();
    </script>
</body>
</html>
