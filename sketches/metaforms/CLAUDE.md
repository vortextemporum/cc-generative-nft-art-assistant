# METAFORMS - AI Assistant Guide

## Project Overview

**Metaforms** is a generative 3D sculpture system using metaballs and marching cubes in Three.js. It creates weird, organic blob objects with varied materials, geometric distortions, surface growths, and boolean cuts.

**Core Concept**: Port of 2D bezier blob generator to 3D metaball isosurfaces with extensive material and manipulation systems.

**Framework**: Three.js (WebGL)

## File Structure

```
metaforms/
├── index.html          # Viewer with full dev mode UI
├── sketch.js           # Main Three.js sketch
├── CLAUDE.md           # This file
├── README.md           # User documentation
├── CHANGELOG.md        # Version history
├── versions/           # Archived versions
│   └── .gitkeep
└── docs/
    ├── FEATURES.md     # Feature/rarity documentation
    └── TECHNICAL.md    # Technical implementation
```

## Current Version: 1.0.0

## Key Concepts

### Metaball System
- `MetaballField` class manages ball positions and radii
- `marchingCubes()` converts scalar field to triangle mesh
- Resolution: 64x64x64 grid by default
- Threshold: 1.0 isosurface value

### Feature Categories
1. **Material** (7 types): Matte, Glossy, Chrome, Iridescent, Glass, Emissive, Holographic
2. **Aesthetic** (5 types): Sculptural, Organic, Alien, Playful, SciFi
3. **Distortion** (6 types): None, Twist, Taper, Bend, Bulge, Wave
4. **Growth** (5 types): None, Spikes, Tendrils, Bumps, Crystals
5. **Boolean** (5 types): None, Sphere Cut, Box Cut, Cylinder Cut, Multi Cut
6. **Color**: Procedural HSL based on 8 hue families

### Dev Mode Features
- Parameter sliders for real-time adjustment
- Like/Dislike feedback system (localStorage)
- Rarity curve visualization
- Override indicator when parameters modified

## Quick Commands

```bash
# Open in browser
open sketches/metaforms/index.html

# Test specific hash
# Add ?hash=0x... to URL
```

## Making Changes

### Before editing:
```bash
# Archive current version
cp sketch.js versions/v1.0.0-sketch.js
```

### After editing:
1. Update version in `sketch.js` (VERSION constant)
2. Update version in `index.html` (title, header, footer)
3. Update `CHANGELOG.md`

## Version Numbering

- **Major** (2.0.0): Changes to hash→visual mapping
- **Minor** (1.1.0): New features, backward compatible
- **Patch** (1.0.1): Bug fixes, performance

## Key Functions

| Function | Purpose |
|----------|---------|
| `generateFeatures()` | Roll all features from hash |
| `initThree()` | Set up scene, camera, renderer, lights |
| `generateMetaform()` | Create metaball mesh with all effects |
| `marchingCubes()` | Convert scalar field to geometry |
| `applyDistortion()` | Vertex manipulation (twist, bend, etc.) |
| `applyBooleanEffect()` | Simulated CSG operations |
| `addGrowths()` | Generate surface protrusions |
| `createMaterial()` | Return Three.js material by type |

## Global API

```javascript
window.metaforms = {
  regenerate(),           // New random hash
  saveImage(),           // Download PNG
  recordFeedback(bool),  // Like/dislike
  setParameter(name, val), // Override feature
  resetToOriginal(),     // Restore hash features
  getFeatures(),         // Current feature object
  getHash(),             // Current hash string
  getRarityCurves(),     // Probability distributions
  VERSION                // "1.0.0"
};
```

## Dependencies

- Three.js r128 (CDN)
- OrbitControls (CDN)

## Notes

- Marching cubes uses simplified triangle lookup (not full 256 cases)
- Boolean operations are simulated via vertex displacement, not true CSG
- Glass material requires WebGL 2 for transmission
- Feedback stored in localStorage as `metaforms-feedback`


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>