<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Micro-Cosmos II</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a12;
            color: #ccd;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #canvas-container {
            width: 800px;
            height: 800px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow:
                0 0 60px rgba(100, 200, 150, 0.15),
                0 0 120px rgba(100, 200, 150, 0.08),
                inset 0 0 100px rgba(0, 0, 0, 0.5);
        }

        #canvas-container canvas {
            display: block;
            border-radius: 8px;
        }

        /* Microscope frame effect */
        #microscope-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: radial-gradient(
                circle at center,
                transparent 40%,
                rgba(0,0,0,0.15) 70%,
                rgba(0,0,0,0.4) 100%
            );
            border-radius: 8px;
            z-index: 50;
        }

        /* UI Overlay */
        .ui-overlay {
            position: fixed;
            z-index: 100;
            pointer-events: none;
        }

        .ui-overlay > * {
            pointer-events: auto;
        }

        /* Top left - Title and zoom */
        #top-left {
            top: 20px;
            left: 20px;
        }

        #title {
            font-size: 24px;
            font-weight: bold;
            color: #8fa;
            text-shadow: 0 0 10px #4a8;
            margin-bottom: 8px;
        }

        #zoom-display {
            font-size: 14px;
            color: #8af;
            background: rgba(0,0,0,0.5);
            padding: 4px 10px;
            border-radius: 4px;
            display: inline-block;
        }

        /* Top right - Features panel */
        #top-right {
            top: 20px;
            right: 20px;
        }

        #features-panel {
            background: rgba(10, 15, 20, 0.85);
            border: 1px solid #2a3a4a;
            border-radius: 8px;
            padding: 15px;
            min-width: 180px;
            backdrop-filter: blur(10px);
        }

        #features-panel h3 {
            font-size: 12px;
            color: #6a8;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #features .feature {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(100,150,100,0.1);
        }

        #features .label {
            color: #889;
        }

        #features .value {
            color: #afe;
            font-weight: bold;
        }

        .rarity-common { color: #aaa !important; }
        .rarity-uncommon { color: #4af !important; }
        .rarity-rare { color: #f4a !important; }
        .rarity-legendary { color: #fa0 !important; text-shadow: 0 0 8px #f80; }

        #hash-display {
            font-size: 10px;
            color: #556;
            margin-top: 10px;
            font-family: monospace;
        }

        /* Bottom left - Controls */
        #bottom-left {
            bottom: 20px;
            left: 20px;
        }

        #controls {
            background: rgba(10, 15, 20, 0.85);
            border: 1px solid #2a3a4a;
            border-radius: 8px;
            padding: 12px;
            backdrop-filter: blur(10px);
        }

        #controls button {
            background: #1a2a3a;
            border: 1px solid #3a4a5a;
            color: #8af;
            padding: 8px 16px;
            margin: 4px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            transition: all 0.2s;
        }

        #controls button:hover {
            background: #2a3a4a;
            border-color: #8af;
        }

        #controls button.dev {
            border-color: #5a4a3a;
            color: #fa8;
        }

        #controls button.dev:hover {
            border-color: #fa8;
        }

        /* Speed slider */
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding: 4px;
            font-size: 11px;
        }

        .speed-control label {
            color: #778;
            white-space: nowrap;
        }

        .speed-control input[type="range"] {
            -webkit-appearance: none;
            width: 100px;
            height: 4px;
            background: #2a3a4a;
            border-radius: 2px;
            outline: none;
        }

        .speed-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #8af;
            border-radius: 50%;
            cursor: pointer;
        }

        .speed-control #speed-label {
            color: #8af;
            font-weight: bold;
            min-width: 30px;
        }

        /* Visual toggles panel */
        #visual-panel {
            background: rgba(10, 15, 20, 0.85);
            border: 1px solid #2a3a4a;
            border-radius: 8px;
            padding: 12px;
            backdrop-filter: blur(10px);
            margin-top: 10px;
        }

        #visual-panel h4 {
            font-size: 10px;
            color: #5a7;
            margin: 8px 0 4px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #visual-panel h4:first-child {
            margin-top: 0;
        }

        .vis-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .vis-toggles button {
            background: #1a2a3a;
            border: 1px solid #3a4a5a;
            color: #889;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            transition: all 0.2s;
        }

        .vis-toggles button:hover {
            background: #2a3a4a;
            color: #afe;
        }

        .vis-toggles button.active {
            background: rgba(60, 100, 80, 0.5);
            border-color: #8fa;
            color: #8fa;
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 11px;
        }

        .size-control label {
            color: #778;
            white-space: nowrap;
        }

        .size-control input[type="range"] {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #2a3a4a;
            border-radius: 2px;
            outline: none;
        }

        .size-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #8fa;
            border-radius: 50%;
            cursor: pointer;
        }

        .size-control #size-label {
            color: #8fa;
            font-weight: bold;
            min-width: 30px;
        }

        /* Bottom right - Keyboard hints */
        #bottom-right {
            bottom: 20px;
            right: 20px;
        }

        #keyboard-hints {
            background: rgba(10, 15, 20, 0.7);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 11px;
            color: #667;
        }

        #keyboard-hints kbd {
            background: #1a2a3a;
            border: 1px solid #3a4a5a;
            border-radius: 3px;
            padding: 2px 6px;
            margin: 0 4px;
            color: #8af;
        }

        #keyboard-hints .hint {
            margin: 3px 0;
        }

        /* Scale bar */
        #scale-bar {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        #scale-bar .bar {
            width: 80px;
            height: 3px;
            background: rgba(150,200,150,0.5);
            border-radius: 2px;
        }

        #scale-bar .label {
            text-align: center;
            font-size: 10px;
            color: #6a8;
            margin-top: 4px;
        }

        /* Status indicators */
        #status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            background: rgba(0,0,0,0.8);
            padding: 20px 40px;
            border-radius: 8px;
            display: none;
            color: #8fa;
            font-size: 18px;
        }

        #status.visible {
            display: block;
        }

        /* Loading screen */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a12;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }

        #loading.hidden {
            display: none;
        }

        #loading h1 {
            color: #8fa;
            font-size: 32px;
            margin-bottom: 20px;
        }

        #loading p {
            color: #556;
            font-size: 14px;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid #1a2a3a;
            border-top-color: #8fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Version badge */
        #version {
            position: fixed;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #334;
            z-index: 100;
        }

        /* Zoom level indicator */
        #zoom-levels {
            position: fixed;
            left: 50%;
            top: 80px;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .zoom-level-btn {
            background: rgba(20, 30, 40, 0.8);
            border: 1px solid #3a4a5a;
            color: #667;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            transition: all 0.2s;
        }

        .zoom-level-btn:hover {
            background: rgba(40, 60, 80, 0.8);
            color: #8af;
        }

        .zoom-level-btn.active {
            background: rgba(60, 100, 80, 0.6);
            border-color: #8fa;
            color: #8fa;
        }

    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <div class="loader"></div>
        <h1>Micro-Cosmos II</h1>
        <p>Seeding particle life...</p>
    </div>

    <!-- Canvas Container (fixed 800x800 circle) -->
    <div id="canvas-container">
        <!-- Microscope vignette effect -->
        <div id="microscope-frame"></div>
    </div>

    <!-- Zoom Level Buttons -->
    <div id="zoom-levels">
        <button class="zoom-level-btn active" onclick="setZoom(1)">Macro</button>
        <button class="zoom-level-btn" onclick="setZoom(4)">Cellular</button>
        <button class="zoom-level-btn" onclick="setZoom(15)">Organelle</button>
        <button class="zoom-level-btn" onclick="setZoom(40)">Molecular</button>
        <button class="zoom-level-btn" onclick="setZoom(120)">Atomic</button>
    </div>

    <!-- UI Overlays -->
    <div id="top-left" class="ui-overlay">
        <div id="title">Micro-Cosmos II</div>
        <div id="zoom-display">10x - macro</div>
    </div>

    <div id="top-right" class="ui-overlay">
        <div id="features-panel">
            <h3>Features</h3>
            <div id="features"></div>
            <div id="hash-display"></div>
        </div>
    </div>

    <div id="bottom-left" class="ui-overlay">
        <div id="controls">
            <button onclick="regenerate()">Regenerate (R)</button>
            <button onclick="devRandomize()" class="dev">Dev Random (D)</button>
            <button onclick="saveImage()">Save (S)</button>
            <button onclick="paused = !paused">Pause (Space)</button>
            <button onclick="toggleFullscreen()">Fullscreen (F)</button>
            <div class="speed-control">
                <label>Speed</label>
                <input type="range" min="0.01" max="1.0" step="0.01" value="1.0" oninput="setSimSpeed(this.value)">
                <span id="speed-label">1.00x</span>
            </div>
        </div>
        <div id="visual-panel">
            <h4>Network</h4>
            <div class="vis-toggles">
                <button id="vis-connections" onclick="toggleVisual('connections')">Connections (C)</button>
                <button id="vis-repulsion" onclick="toggleVisual('repulsion')">Repulsion (W)</button>
                <button id="vis-velocity" onclick="toggleVisual('velocity')">Velocity (V)</button>
                <button id="vis-trails" onclick="toggleVisual('trails')">Trails (T)</button>
            </div>
            <h4>Shape</h4>
            <div class="vis-toggles">
                <button id="vis-halos" onclick="toggleVisual('halos')">Halos (H)</button>
                <button id="vis-soft" onclick="toggleVisual('soft')">Soft (G)</button>
                <button id="vis-stars" onclick="toggleVisual('stars')">Stars (J)</button>
                <button id="vis-rings" onclick="toggleVisual('rings')">Rings (O)</button>
            </div>
            <h4>Color</h4>
            <div class="vis-toggles">
                <button id="vis-mono" onclick="toggleVisual('mono')">Mono (M)</button>
                <button id="vis-rainbow" onclick="toggleVisual('rainbow')">Rainbow (N)</button>
                <button id="vis-invert" onclick="toggleVisual('invert')">Invert (I)</button>
                <button id="vis-xray" onclick="toggleVisual('xray')">X-Ray (X)</button>
            </div>
            <h4>Animate</h4>
            <div class="vis-toggles">
                <button id="vis-pulse" onclick="toggleVisual('pulse')">Pulse (P)</button>
                <button id="vis-flicker" onclick="toggleVisual('flicker')">Flicker (K)</button>
            </div>
            <h4>Adjust</h4>
            <div class="size-control">
                <label>Size</label>
                <input type="range" min="0.3" max="4.0" step="0.1" value="1.0" oninput="setVisualSize(this.value)">
                <span id="size-label">1.0x</span>
            </div>
            <div class="size-control">
                <label>Conn radius</label>
                <input type="range" min="0.2" max="3.0" step="0.1" value="1.0" oninput="setConnRadius(this.value)">
                <span id="conn-label">1.0x</span>
            </div>
            <div class="size-control">
                <label>Trail fade</label>
                <input type="range" min="0.2" max="3.0" step="0.1" value="1.0" oninput="setTrailFade(this.value)">
                <span id="trail-label">1.0x</span>
            </div>
            <div class="size-control">
                <label>Hue shift</label>
                <input type="range" min="0" max="1.0" step="0.01" value="0" oninput="setHueShift(this.value)">
                <span id="hue-label">0&deg;</span>
            </div>
        </div>
    </div>

    <div id="bottom-right" class="ui-overlay">
        <div id="keyboard-hints">
            <div class="hint"><kbd>Scroll</kbd> Zoom in/out</div>
            <div class="hint"><kbd>1-5</kbd> Zoom presets</div>
            <div class="hint"><kbd>Space</kbd> Pause</div>
            <div class="hint"><kbd>R</kbd> Regenerate</div>
            <div class="hint"><kbd>D</kbd> Dev random</div>
            <div class="hint"><kbd>F</kbd> Fullscreen</div>
            <div class="hint">Visual toggles: see panel</div>
        </div>
    </div>

    <div id="scale-bar">
        <div class="bar"></div>
        <div class="label" id="scale-label">50 μm</div>
    </div>

    <div id="status"></div>

    <div id="version">v2.0.0</div>

    <!-- Three.js -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

    <!-- Main sketch -->
    <script src="sketch.js"></script>

    <script>
        // Hide loading screen when ready
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 500);
        });

        // Set zoom level
        function setZoom(level) {
            targetZoom = level;
            updateZoomButtons();
        }

        // Update zoom button states
        function updateZoomButtons() {
            const buttons = document.querySelectorAll('.zoom-level-btn');
            const thresholds = [2, 8, 25, 80];

            buttons.forEach((btn, i) => {
                btn.classList.remove('active');
                if (i === 0 && currentZoom < thresholds[0]) btn.classList.add('active');
                else if (i === 1 && currentZoom >= thresholds[0] && currentZoom < thresholds[1]) btn.classList.add('active');
                else if (i === 2 && currentZoom >= thresholds[1] && currentZoom < thresholds[2]) btn.classList.add('active');
                else if (i === 3 && currentZoom >= thresholds[2] && currentZoom < thresholds[3]) btn.classList.add('active');
                else if (i === 4 && currentZoom >= thresholds[3]) btn.classList.add('active');
            });
        }

        // Update scale bar based on zoom
        function updateScaleBar() {
            const scaleLabel = document.getElementById('scale-label');
            const zoom = currentZoom || 1;

            const scales = [
                { zoom: 0.5, label: '200 μm' },
                { zoom: 1, label: '100 μm' },
                { zoom: 2, label: '50 μm' },
                { zoom: 5, label: '20 μm' },
                { zoom: 10, label: '10 μm' },
                { zoom: 20, label: '5 μm' },
                { zoom: 40, label: '2 μm' },
                { zoom: 60, label: '500 nm' },
                { zoom: 80, label: '100 nm' },
                { zoom: 100, label: '50 nm' }
            ];

            let scale = scales[0];
            for (const s of scales) {
                if (zoom >= s.zoom) scale = s;
            }

            scaleLabel.textContent = scale.label;
            updateZoomButtons();
        }

        // Update scale bar periodically
        setInterval(updateScaleBar, 100);
    </script>
</body>
</html>
