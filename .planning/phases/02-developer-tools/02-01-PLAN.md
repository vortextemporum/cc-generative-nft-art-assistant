---
phase: 02-developer-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp-server/package.json
  - mcp-server/src/index.js
  - mcp-server/src/tools/search.js
  - mcp-server/src/tools/code.js
  - mcp-server/src/tools/stats.js
  - mcp-server/src/lib/response.js
  - mcp-server/README.md
autonomous: true

must_haves:
  truths:
    - "MCP server starts without errors"
    - "Claude Desktop can connect and list tools"
    - "search_projects returns technique explanations, not full code"
    - "get_project_code returns full source code when requested"
    - "Filters work (platform, framework, artist)"
  artifacts:
    - path: "mcp-server/src/index.js"
      provides: "MCP server entry with SDK v1.x API"
      exports: ["server"]
    - path: "mcp-server/src/tools/search.js"
      provides: "Semantic search tool using Phase 1 API"
      exports: ["searchTool", "searchByPatternTool"]
    - path: "mcp-server/src/tools/code.js"
      provides: "Code retrieval tool"
      exports: ["getCodeTool"]
    - path: "mcp-server/src/lib/response.js"
      provides: "Technique-focused response formatter"
      exports: ["formatSearchResult", "formatCodeResult"]
  key_links:
    - from: "mcp-server/src/tools/search.js"
      to: "services/embeddings/index.js"
      via: "import { search } from"
      pattern: "import.*search.*from.*services/embeddings"
    - from: "mcp-server/src/index.js"
      to: "@modelcontextprotocol/sdk"
      via: "SDK v1.25.2"
      pattern: "modelcontextprotocol/sdk/server"
---

<objective>
Refresh MCP server to use Phase 1 embedding search with technique-focused responses

Purpose: Enable Claude Desktop to search the 28k+ project knowledge base with responses that teach technique before showing code, supporting the creative partnership model from CONTEXT.md.

Output: Working MCP server with 4-5 tools, SDK v1.25.2, connected to Phase 1 search API
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-developer-tools/02-CONTEXT.md
@.planning/phases/02-developer-tools/02-RESEARCH.md
@.planning/phases/01-semantic-search/01-02-SUMMARY.md

# Existing code to update
@mcp-server/src/index.js
@mcp-server/package.json
@services/embeddings/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade MCP SDK and restructure server</name>
  <files>
    mcp-server/package.json
    mcp-server/src/index.js
  </files>
  <action>
1. Update mcp-server/package.json:
   - Upgrade @modelcontextprotocol/sdk to ^1.25.2 (from ^0.5.0)
   - Remove @xenova/transformers (not needed - we use Phase 1 search API)
   - Add zod@^3.25 as peer dependency requirement

2. Rewrite mcp-server/src/index.js to use SDK v1.x patterns:
   - Import from @modelcontextprotocol/sdk/server/index.js and stdio.js
   - Import tool handlers from ./tools/ modules
   - Use setRequestHandler(ListToolsRequestSchema) for tool listing
   - Use setRequestHandler(CallToolRequestSchema) for tool execution
   - CRITICAL: All logging MUST use console.error() (not console.log) to avoid stdout corruption
   - Remove resources for now (tools are primary focus)
   - Version should be 2.0.0 (breaking change from old format)

3. Define 5 tools in ListToolsRequestSchema handler:
   - search_projects: Semantic search, returns technique explanations
   - search_by_pattern: Find projects by code pattern
   - get_project_code: Get full source for a specific project
   - get_dataset_stats: Statistics about the dataset
   - get_notable_projects: Popular/notable projects

Tool descriptions should emphasize technique learning:
   - search_projects: "Semantic search across 28k+ generative art projects. Returns technique explanations and key concepts - use get_project_code to see full source."
   - get_project_code: "Get full source code for a specific project. Use after search when you want to study implementation details."
  </action>
  <verify>
    cd mcp-server && npm install && node -c src/index.js
  </verify>
  <done>
    SDK upgraded to 1.25.2, server restructured with v1.x API pattern, 5 tools defined
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tool modules with Phase 1 search integration</name>
  <files>
    mcp-server/src/tools/search.js
    mcp-server/src/tools/code.js
    mcp-server/src/tools/stats.js
    mcp-server/src/lib/response.js
  </files>
  <action>
1. Create mcp-server/src/tools/search.js:
   - Import { search } from relative path to services/embeddings/index.js
   - Import { formatSearchResult } from ../lib/response.js
   - Export async searchProjects(args) that:
     a. Calls search(args.query, { topK: args.limit || 5, filters: { platform: args.platform, framework: args.framework } })
     b. Enriches results with project data from rag-documents.json (description, patterns)
     c. Formats using formatSearchResult (technique-focused, no full code)
     d. Returns array of results
   - Export async searchByPattern(args) that:
     a. Loads rag-documents.json
     b. Filters by pattern in metadata.patterns (case-insensitive partial match)
     c. Returns up to args.limit results with technique info

2. Create mcp-server/src/tools/code.js:
   - Load code-examples.json and data/*.json datasets for full scripts
   - Export async getProjectCode(args) that:
     a. Finds project by projectId in datasets
     b. Returns full script + metadata
     c. Returns error if project not found

3. Create mcp-server/src/tools/stats.js:
   - Load system-knowledge.json
   - Export getStats() returning overview, platforms, techniques
   - Export getNotableProjects(source, limit) returning notable projects

4. Create mcp-server/src/lib/response.js:
   - Export formatSearchResult(result, enrichedData) that returns:
     {
       projectId, name, artist,
       technique: { framework, patterns, keyConceptsUsed, whyItWorks },
       links: { artblocks: url, fxhash: url },
       score
     }
     NOTE: No code preview in search results - that's what get_project_code is for
   - Export formatCodeResult(project) that returns full script with metadata

Key pattern for path resolution:
   const __dirname = path.dirname(fileURLToPath(import.meta.url));
   const ROOT = path.resolve(__dirname, '../../..');
   // Then use path.join(ROOT, 'services/embeddings/index.js') for imports
   // Use path.join(ROOT, 'processed/rag-documents.json') for data files
  </action>
  <verify>
    node -c mcp-server/src/tools/search.js && node -c mcp-server/src/tools/code.js && node -c mcp-server/src/tools/stats.js
  </verify>
  <done>
    Tool modules created, connected to Phase 1 search API, technique-focused formatting implemented
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire tools to server and verify end-to-end</name>
  <files>
    mcp-server/src/index.js
    mcp-server/README.md
  </files>
  <action>
1. Update mcp-server/src/index.js to import and wire tool handlers:
   - Import { searchProjects, searchByPattern } from './tools/search.js'
   - Import { getProjectCode } from './tools/code.js'
   - Import { getStats, getNotableProjects } from './tools/stats.js'
   - In CallToolRequestSchema handler, route to appropriate function
   - Wrap results in { content: [{ type: 'text', text: JSON.stringify(result) }] }
   - Handle errors with { content: [{ type: 'text', text: error.message }], isError: true }

2. Update mcp-server/README.md with:
   - Installation instructions (npm install in mcp-server/)
   - Claude Desktop configuration (claude_desktop_config.json path)
   - Tool descriptions and example queries
   - Note about technique-first philosophy

3. Test the server manually:
   - Run: node mcp-server/src/index.js (should print to stderr and wait for input)
   - Server should not error on startup
   - Ctrl+C to exit
  </action>
  <verify>
    cd /Users/berk/Downloads/generative-art-assistant && timeout 3 node mcp-server/src/index.js 2>&1 || true
  </verify>
  <done>
    MCP server runs without errors, tools wired correctly, README updated with usage instructions
  </done>
</task>

</tasks>

<verification>
1. npm install in mcp-server/ completes without errors
2. node mcp-server/src/index.js starts and prints "Generative Art MCP server running on stdio" to stderr
3. No console.log() calls in any MCP server code (grep for them)
4. search imports from services/embeddings/index.js (not from old processed/embeddings.json)
5. formatSearchResult returns technique info, not full code
</verification>

<success_criteria>
- MCP server starts without errors
- SDK version is 1.25.2
- 5 tools registered (search_projects, search_by_pattern, get_project_code, get_dataset_stats, get_notable_projects)
- Search uses Phase 1 embedding API
- Search results show technique explanations, not full code
- README documents Claude Desktop setup
</success_criteria>

<output>
After completion, create `.planning/phases/02-developer-tools/02-01-SUMMARY.md`
</output>
